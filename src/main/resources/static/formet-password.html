<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>아이디 / 비밀번호 찾기</title>
<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f5f7fb}
.wrap{max-width:520px;margin:60px auto;background:#fff;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.08);padding:26px}
h1{margin:0 0 6px;font-size:22px}
p{margin:0 0 16px;color:#666;font-size:14px}
.tabs{display:flex;gap:8px;margin-bottom:16px}
.tabs button{flex:1;padding:10px;border:0;border-radius:12px;background:#eee;font-weight:700;cursor:pointer}
.tabs .on{background:#111;color:#fff}
label{display:block;font-size:13px;margin:10px 0 6px}
input{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px}
button.main{width:100%;margin-top:14px;padding:12px;border:0;border-radius:12px;background:#111;color:#fff;font-weight:700}
.msg{margin-top:10px;font-size:13px}
.ok{color:#0f766e}.err{color:#b91c1c}
</style>
</head>
<body>

<div class="wrap">
  <h1 id="title">아이디 찾기</h1>
  <p id="desc">가입한 이메일로 계정 존재 여부를 확인합니다.</p>

  <div class="tabs">
    <button id="tab-id" class="on">아이디 찾기</button>
    <button id="tab-pw">비밀번호 찾기</button>
  </div>

  <label>Email</label>
  <input id="email" type="email" placeholder="example@email.com" />

  <div id="pw-area" style="display:none">
    <label>새 비밀번호</label>
    <input id="pw" type="password" placeholder="6자 이상" />

    <label>비밀번호 확인</label>
    <input id="pw2" type="password" />
  </div>

  <button id="btn" class="main">확인</button>
  <div id="msg" class="msg"></div>
</div>

<script>
const params = new URLSearchParams(location.search);
const mode = params.get("mode");
const token = params.get("token");

const tabId = document.getElementById("tab-id");
const tabPw = document.getElementById("tab-pw");
const title = document.getElementById("title");
const desc = document.getElementById("desc");
const email = document.getElementById("email");
const pwArea = document.getElementById("pw-area");
const pw = document.getElementById("pw");
const pw2 = document.getElementById("pw2");
const btn = document.getElementById("btn");
const msg = document.getElementById("msg");

let current = "id";

function setTab(t){
  current = t;
  msg.textContent="";
  tabId.classList.toggle("on", t==="id");
  tabPw.classList.toggle("on", t==="pw");

  if(t==="id"){
    title.textContent="아이디 찾기";
    desc.textContent="가입한 이메일로 계정 존재 여부를 확인합니다.";
    pwArea.style.display="none";
    btn.textContent="확인";
  }else{
    title.textContent="비밀번호 찾기";
    desc.textContent="재설정 링크를 이메일로 보냅니다.";
    pwArea.style.display="none";
    btn.textContent="재설정 링크 보내기";
  }
}

tabId.onclick=()=>setTab("id");
tabPw.onclick=()=>setTab("pw");

if(mode==="reset" && token){
  title.textContent="비밀번호 재설정";
  desc.textContent="새 비밀번호를 입력하세요.";
  pwArea.style.display="block";
  btn.textContent="비밀번호 변경";
  email.style.display="none";
  current="reset";
}

btn.onclick = async ()=>{
  msg.textContent="";

  try{
    if(current==="id"){
      const res = await fetch("/api/auth/find-id",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({email:email.value})
      });
      msg.textContent = await res.text();
      msg.className="msg ok";
    }

    if(current==="pw"){
      const res = await fetch("/api/auth/forgot-password",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({email:email.value})
      });
      msg.textContent = await res.text();
      msg.className="msg ok";
    }

    if(current==="reset"){
      if(pw.value!==pw2.value) throw "비밀번호 불일치";
      const res = await fetch("/api/auth/reset-password",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({token:token,newPassword:pw.value})
      });
      msg.textContent = await res.text();
      msg.className="msg ok";
      setTimeout(()=>location.href="/login.html",900);
    }

  }catch(e){
    msg.textContent = e;
    msg.className="msg err";
  }
};

setTab("id");
</script>

</body>
</html>
